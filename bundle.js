const m="es-AR";const g="http://localhost:5678",S=localStorage.getItem("COS_N8N_HOST"),y=`${(S||g).replace(/\/$/,"")}/webhook/2c8e40bc-d18d-458e-9d02-6ca7be1eb19c/chat`,w=`session_${Date.now()}_${Math.random().toString(36).slice(2,8)}`;async function E(s){const c={chatInput:s,sessionId:w,timestamp:new Date().toISOString()},n=await fetch(y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!n.ok)throw new Error(`Error ${n.status}: ${n.statusText}`);const e=await n.json();return e.output||e.response||"Consulta procesada correctamente."}let u;function f(){const s=window.SpeechRecognition||window.webkitSpeechRecognition;s&&(u=new s,u.lang=m)}function L(s){return new Promise((c,n)=>{if(!("speechSynthesis"in window)){c();return}const e=new SpeechSynthesisUtterance(s);e.lang=m,e.volume=.9,e.onend=c,e.onerror=n,speechSynthesis.speak(e)})}function I(){const s=document.getElementById("sendButton"),c=document.getElementById("messageInput"),n=document.getElementById("chatLog"),e=document.querySelector(".status-dot"),p=document.getElementById("mainStatus"),l=document.getElementById("subStatus");f();function a(t,o){p.textContent=t,l.textContent="",e.style.background=o==="ready"?"#10b981":o==="error"?"#ef4444":"#fbbf24"}function h(t,o){const r=document.createElement("div");r.textContent=t;const d=document.createElement("div");d.textContent=o,n.appendChild(r),n.appendChild(d)}async function i(){const t=c.value.trim();if(t){a("Procesando","processing");try{const o=await E(t);h(t,o),await L(o),a("Sistema listo","ready")}catch(o){console.error(o),a("Sin conexiÃ³n","error")}c.value=""}}s.addEventListener("click",i),c.addEventListener("keydown",t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),i())})}document.addEventListener("DOMContentLoaded",()=>{I()});
